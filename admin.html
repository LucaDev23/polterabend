<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel ‚Äì Polterabend</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #C9A96E;
    --gold-light: #E8D5B0;
    --dark: #0D0D0D;
    --dark2: #161616;
    --dark3: #1E1E1E;
    --dark4: #252525;
    --text: #F0EDE8;
    --text-muted: #888;
    --green: #4CAF7D;
    --red: #E05A5A;
    --blue: #5A9EE0;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    padding-bottom: 60px;
  }

  /* HEADER */
  .header {
    background: var(--dark2);
    border-bottom: 1px solid #2a2a2a;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .header-left { }
  .header-label {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 4px;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    font-weight: 700;
  }
  .admin-badge {
    background: rgba(224, 90, 90, 0.1);
    border: 1px solid rgba(224, 90, 90, 0.3);
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 12px;
    color: var(--red);
    font-weight: 500;
  }

  /* LOGIN SCREEN */
  .login-screen {
    max-width: 360px;
    margin: 60px auto;
    padding: 0 20px;
    text-align: center;
  }
  .login-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }
  .login-title {
    font-family: 'Playfair Display', serif;
    font-size: 24px;
    margin-bottom: 8px;
  }
  .login-sub {
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 28px;
  }
  .login-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .login-btn {
    background: var(--dark2);
    border: 1px solid #2a2a2a;
    border-radius: 12px;
    padding: 14px 20px;
    cursor: pointer;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .login-btn:hover {
    border-color: var(--gold);
    background: rgba(201, 169, 110, 0.05);
  }
  .login-btn .btn-icon {
    font-size: 22px;
  }
  .login-btn .btn-info { text-align: left; }
  .login-btn .btn-name { font-size: 14px; }
  .login-btn .btn-role { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

  /* MAIN */
  .container {
    max-width: 480px;
    margin: 0 auto;
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* CARD */
  .card {
    background: var(--dark2);
    border: 1px solid #2a2a2a;
    border-radius: 16px;
    padding: 18px;
  }
  .card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }
  .card-icon {
    width: 36px; height: 36px;
    background: rgba(201, 169, 110, 0.1);
    border: 1px solid rgba(201, 169, 110, 0.2);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
  }
  .card-title {
    font-family: 'Playfair Display', serif;
    font-size: 15px;
    font-weight: 600;
  }
  .card-sub {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* TASK LIST */
  .task-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 0;
    border-bottom: 1px solid #222;
  }
  .task-item:last-child { border-bottom: none; }
  .task-toggle {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid #333;
    background: transparent;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: all 0.2s;
    color: white;
    font-size: 13px;
    font-weight: 700;
  }
  .task-toggle.done {
    background: var(--green);
    border-color: var(--green);
  }
  .task-toggle:hover:not(.done) {
    border-color: var(--green);
    background: rgba(76, 175, 125, 0.1);
  }
  .task-info { flex: 1; }
  .task-name {
    font-size: 14px;
    font-weight: 500;
    transition: color 0.2s;
  }
  .task-item.done .task-name {
    color: var(--text-muted);
    text-decoration: line-through;
    text-decoration-color: rgba(136,136,136,0.4);
  }
  .task-desc {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }
  .task-pts {
    font-size: 11px;
    color: var(--gold);
    margin-top: 3px;
  }
  .task-donetime {
    font-size: 11px;
    color: var(--green);
    margin-top: 2px;
  }

  /* TACHO CONTROL */
  .tacho-control {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .tacho-display {
    text-align: center;
    padding: 16px 0 8px;
  }
  .tacho-val {
    font-family: 'Playfair Display', serif;
    font-size: 52px;
    font-weight: 700;
    color: var(--gold);
    line-height: 1;
  }
  .tacho-unit {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
  }
  .slider-wrap {
    position: relative;
  }
  input[type="range"] {
    width: 100%;
    -webkit-appearance: none;
    height: 6px;
    border-radius: 10px;
    background: linear-gradient(90deg, var(--green) 0%, var(--gold) 50%, var(--red) 100%);
    outline: none;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--gold);
    border: 2px solid var(--dark);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(201, 169, 110, 0.4);
  }
  .slider-labels {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 6px;
  }
  .save-btn {
    background: linear-gradient(135deg, var(--gold), var(--gold-light));
    color: var(--dark);
    border: none;
    border-radius: 12px;
    padding: 13px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
    transition: opacity 0.2s, transform 0.1s;
  }
  .save-btn:hover { opacity: 0.9; }
  .save-btn:active { transform: scale(0.98); }
  .save-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* LOCATION */
  .location-control {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .input-group {
    display: flex;
    gap: 8px;
  }
  input[type="text"] {
    flex: 1;
    background: var(--dark4);
    border: 1px solid #333;
    border-radius: 10px;
    padding: 12px 14px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }
  input[type="text"]:focus { border-color: var(--gold); }
  input[type="text"]::placeholder { color: var(--text-muted); }
  .geo-btn {
    background: var(--dark4);
    border: 1px solid #333;
    border-radius: 10px;
    padding: 12px 14px;
    color: var(--gold);
    cursor: pointer;
    font-size: 18px;
    transition: background 0.2s;
    white-space: nowrap;
  }
  .geo-btn:hover { background: rgba(201, 169, 110, 0.1); }
  .current-location {
    font-size: 12px;
    color: var(--text-muted);
    padding: 8px 0;
    line-height: 1.4;
  }
  .current-location strong { color: var(--text); }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--dark3);
    border: 1px solid #333;
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 13px;
    z-index: 1000;
    transition: transform 0.3s ease;
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.success { border-color: rgba(76, 175, 125, 0.4); color: var(--green); }
  .toast.error { border-color: rgba(224, 90, 90, 0.4); color: var(--red); }

  /* WHO LOGGED IN */
  .logged-as {
    background: rgba(201, 169, 110, 0.05);
    border: 1px solid rgba(201, 169, 110, 0.15);
    border-radius: 10px;
    padding: 10px 14px;
    font-size: 12px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .logged-as strong { color: var(--gold); }
  .logout-btn {
    background: transparent;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 4px 10px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 11px;
    font-family: 'DM Sans', sans-serif;
  }
  .logout-btn:hover { color: var(--red); border-color: var(--red); }

  /* LEVEL DISPLAY */
  .level-display {
    text-align: center;
    padding: 10px 0;
  }
  .level-display .lv-num {
    font-family: 'Playfair Display', serif;
    font-size: 36px;
    font-weight: 700;
    color: var(--gold);
  }
  .level-display .lv-name {
    font-size: 14px;
    color: var(--text-muted);
    margin-top: 4px;
  }
  .progress-bar {
    background: var(--dark4);
    border-radius: 10px;
    height: 8px;
    overflow: hidden;
    margin: 12px 0 6px;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), var(--gold-light));
    border-radius: 10px;
    transition: width 0.8s ease;
  }
  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--text-muted);
  }

  /* CONFIG NOTICE */
  .config-notice {
    background: rgba(90, 158, 224, 0.08);
    border: 1px solid rgba(90, 158, 224, 0.2);
    border-radius: 12px;
    padding: 16px;
    font-size: 13px;
    color: #a0c4e8;
    line-height: 1.6;
  }
  .config-notice code {
    background: rgba(0,0,0,0.3);
    padding: 1px 5px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 12px;
    display: block;
    margin-top: 8px;
    color: var(--gold-light);
  }

  #loginScreen { display: flex; flex-direction: column; }
  #adminPanel { display: none; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="header-label">Admin Panel</div>
    <h1>Polterabend ü•Ç</h1>
  </div>
  <div class="admin-badge">üîê Admin</div>
</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-screen">
  <div class="login-icon">üé©</div>
  <h2 class="login-title">Wer bist du?</h2>
  <p class="login-sub">W√§hle deinen Admin-Account</p>
  <div class="login-buttons" id="loginButtons">
    <!-- Filled by JS -->
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <div class="container">

    <!-- LOGGED AS -->
    <div class="logged-as">
      <span>Eingeloggt als: <strong id="loggedName">‚Äì</strong></span>
      <button class="logout-btn" onclick="logout()">Abmelden</button>
    </div>

    <!-- LEVEL OVERVIEW -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üèÜ</div>
        <div>
          <div class="card-title">Level-Fortschritt</div>
          <div class="card-sub">Wird automatisch berechnet</div>
        </div>
      </div>
      <div class="level-display">
        <div class="lv-num" id="adminLvNum">LVL 1</div>
        <div class="lv-name" id="adminLvName">N√ºchterner Anf√§nger</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="adminProgress" style="width:0%"></div>
      </div>
      <div class="progress-label">
        <span id="adminProgDone">0 erledigt</span>
        <span id="adminProgTotal">0 Aufgaben</span>
      </div>
    </div>

    <!-- TASKS -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">‚úÖ</div>
        <div>
          <div class="card-title">Aufgaben abhaken</div>
          <div class="card-sub">Tippe auf den Kreis zum Abhaken</div>
        </div>
      </div>
      <div id="adminTaskList">
        <div style="text-align:center; padding:20px; color: var(--text-muted); font-size:14px;">Lade Aufgaben...</div>
      </div>
    </div>

    <!-- TACHO -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üç∫</div>
        <div>
          <div class="card-title">Promille-Level setzen</div>
          <div class="card-sub">Sch√§tzwert f√ºr alle sichtbar</div>
        </div>
      </div>
      <div class="tacho-control">
        <div class="tacho-display">
          <div class="tacho-val" id="adminTachoVal">0.0</div>
          <div class="tacho-unit">‚Ä∞ Promille</div>
        </div>
        <input type="range" id="tachoSlider" min="0" max="3" step="0.1" value="0"
          oninput="document.getElementById('adminTachoVal').textContent = parseFloat(this.value).toFixed(1)">
        <div class="slider-labels">
          <span>0.0 n√ºchtern</span>
          <span>1.5 üéâ</span>
          <span>3.0 üëë</span>
        </div>
        <button class="save-btn" onclick="saveTacho()">Promille-Level speichern</button>
      </div>
    </div>

    <!-- LOCATION -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üìç</div>
        <div>
          <div class="card-title">Standort aktualisieren</div>
          <div class="card-sub">Alle sehen deinen Standort</div>
        </div>
      </div>
      <div class="location-control">
        <div class="current-location" id="currentLocDisplay">
          Aktueller Standort: <strong>‚Äì</strong>
        </div>
        <div class="input-group">
          <input type="text" id="locationInput" placeholder="Bar-Name oder Adresse eingeben..." />
          <button class="geo-btn" onclick="getGeoLocation()" title="GPS-Standort ermitteln">üì°</button>
        </div>
        <button class="save-btn" onclick="saveLocation()">Standort speichern</button>
      </div>
    </div>

    <!-- CONFIG NOTICE -->
    <div class="config-notice" id="adminConfigNotice" style="display:none">
      ‚öôÔ∏è <strong>Setup-Hinweis:</strong> Firebase noch nicht konfiguriert.<br>
      Ersetze den <code>firebaseConfig</code> Block am Ende dieser Datei mit deinen Firebase-Projekt-Daten. Du findest diese in der Firebase Console unter Projekteinstellungen.
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
  import { getFirestore, doc, setDoc, updateDoc, onSnapshot, collection, serverTimestamp }
    from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

  // ======================================================
  // üîß FIREBASE CONFIG ‚Äì hier deine Werte eintragen!
  // ======================================================
  const firebaseConfig = {
    apiKey: "AIzaSyCe7rnFtDIEky4T3dJm01yVM24wz5by9zI",
    authDomain: "polterabend-mrt.firebaseapp.com",
    projectId: "polterabend-mrt",
    storageBucket: "polterabend-mrt.firebasestorage.app",
    messagingSenderId: "895557787854",
    appId: "1:895557787854:web:0739bf5ab761c435b8f09f"
  };
  // ======================================================

  // ======================================================
  // üë• ADMINS ‚Äì hier eure Namen eintragen
  // ======================================================
  const ADMINS = [
    { id: 'admin1', name: 'Kunz', emoji: 'üé©' },
    { id: 'admin2', name: 'Maranta', emoji: 'üç∫' },
    { id: 'admin3', name: 'Haui', emoji: 'üéâ' },
  ];
  // ======================================================

  // ======================================================
  // üìã AUFGABEN ‚Äì hier eure Aufgaben eintragen!
  // ======================================================
  const INITIAL_TASKS = [
    { id: 'task1', order: 1, name: 'Aufgabe 1: Platzhalter', desc: 'Beschreibung der ersten Aufgabe', points: 100, done: false, doneAt: null },
    { id: 'task2', order: 2, name: 'Aufgabe 2: Platzhalter', desc: 'Beschreibung der zweiten Aufgabe', points: 150, done: false, doneAt: null },
    { id: 'task3', order: 3, name: 'Aufgabe 3: Platzhalter', desc: 'Beschreibung der dritten Aufgabe', points: 200, done: false, doneAt: null },
    { id: 'task4', order: 4, name: 'Aufgabe 4: Platzhalter', desc: 'Beschreibung der vierten Aufgabe', points: 250, done: false, doneAt: null },
    { id: 'task5', order: 5, name: 'Aufgabe 5: Platzhalter', desc: 'Beschreibung der f√ºnften Aufgabe', points: 300, done: false, doneAt: null },
  ];
  // ======================================================

  const isConfigured = firebaseConfig.apiKey !== "DEIN_API_KEY";
  let db, currentAdmin = null, tasks = [];

  // Setup login buttons
  const loginBtns = document.getElementById('loginButtons');
  ADMINS.forEach(admin => {
    const btn = document.createElement('button');
    btn.className = 'login-btn';
    btn.innerHTML = `<span class="btn-icon">${admin.emoji}</span><div class="btn-info"><div class="btn-name">${admin.name}</div><div class="btn-role">Admin</div></div>`;
    btn.onclick = () => login(admin);
    loginBtns.appendChild(btn);
  });

  window.login = function(admin) {
    currentAdmin = admin;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('loggedName').textContent = `${admin.emoji} ${admin.name}`;

    if (!isConfigured) {
      document.getElementById('adminConfigNotice').style.display = 'block';
      renderDummyTasks();
      return;
    }

    db = getFirestore(initializeApp(firebaseConfig));
    initFirebase();
  };

  window.logout = function() {
    currentAdmin = null;
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('adminPanel').style.display = 'none';
  };

  async function initFirebase() {
    // Init tasks if needed
    const stateRef = doc(db, 'polter', 'state');
    onSnapshot(stateRef, async (snap) => {
      if (!snap.exists()) {
        // First time setup - init tasks
        for (const task of INITIAL_TASKS) {
          await setDoc(doc(db, 'polter', 'data', 'tasks', task.id), task);
        }
        await setDoc(stateRef, { alcoholLevel: 0, location: '', totalCount: INITIAL_TASKS.length, completedCount: 0 });
      }
      const data = snap.data() || {};
      document.getElementById('tachoSlider').value = data.alcoholLevel || 0;
      document.getElementById('adminTachoVal').textContent = (data.alcoholLevel || 0).toFixed(1);
      if (data.location) {
        document.getElementById('currentLocDisplay').innerHTML = `Aktuell: <strong>${data.location}</strong>`;
      }
    });

    // Tasks listener
    onSnapshot(collection(db, 'polter', 'data', 'tasks'), (snap) => {
      tasks = [];
      snap.forEach(d => tasks.push({ id: d.id, ...d.data() }));
      tasks.sort((a, b) => (a.order || 0) - (b.order || 0));
      renderAdminTasks(tasks);
      updateLevelDisplay(tasks.filter(t => t.done).length, tasks.length);
    });
  }

  function renderAdminTasks(taskArr) {
    const list = document.getElementById('adminTaskList');
    list.innerHTML = '';
    taskArr.forEach(task => {
      const div = document.createElement('div');
      div.className = `task-item${task.done ? ' done' : ''}`;
      let doneHtml = '';
      if (task.done && task.doneAt) {
        const d = new Date(task.doneAt);
        doneHtml = `<div class="task-donetime">‚úì Erledigt um ${d.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })} Uhr</div>`;
      }
      div.innerHTML = `
        <button class="task-toggle${task.done ? ' done' : ''}" onclick="toggleTask('${task.id}', ${task.done})">${task.done ? '‚úì' : ''}</button>
        <div class="task-info">
          <div class="task-name">${task.name}</div>
          ${task.desc ? `<div class="task-desc">${task.desc}</div>` : ''}
          ${task.points ? `<div class="task-pts">+${task.points} Punkte</div>` : ''}
          ${doneHtml}
        </div>`;
      list.appendChild(div);
    });
  }

  function renderDummyTasks() {
    renderAdminTasks(INITIAL_TASKS);
    updateLevelDisplay(0, INITIAL_TASKS.length);
  }

  function updateLevelDisplay(done, total) {
    const levels = [
      { name: 'N√ºchterner Anf√§nger', min: 0 },
      { name: 'Abenteurer', min: 2 },
      { name: 'Polter-Veteran', min: 4 },
      { name: 'Chaos-Meister', min: 7 },
      { name: 'Polter-Legende', min: total },
    ];
    let lvlIdx = 0;
    for (let i = 0; i < levels.length; i++) {
      if (done >= levels[i].min) lvlIdx = i;
    }
    document.getElementById('adminLvNum').textContent = `LVL ${lvlIdx + 1}`;
    document.getElementById('adminLvName').textContent = levels[lvlIdx].name;
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    document.getElementById('adminProgress').style.width = pct + '%';
    document.getElementById('adminProgDone').textContent = `${done} erledigt`;
    document.getElementById('adminProgTotal').textContent = `${total} Aufgaben`;
  }

  window.toggleTask = async function(taskId, currentDone) {
    if (!isConfigured) { showToast('Firebase nicht konfiguriert!', 'error'); return; }
    const newDone = !currentDone;
    await updateDoc(doc(db, 'polter', 'data', 'tasks', taskId), {
      done: newDone,
      doneAt: newDone ? new Date().toISOString() : null
    });
    // Update completedCount in state
    const done = tasks.filter(t => t.done).length + (newDone ? 1 : -1);
    await updateDoc(doc(db, 'polter', 'state'), { completedCount: Math.max(0, done) });
    showToast(newDone ? '‚úì Aufgabe abgehakt!' : 'Aufgabe zur√ºckgesetzt', 'success');
  };

  window.saveTacho = async function() {
    if (!isConfigured) { showToast('Firebase nicht konfiguriert!', 'error'); return; }
    const val = parseFloat(document.getElementById('tachoSlider').value);
    await updateDoc(doc(db, 'polter', 'state'), { alcoholLevel: val });
    showToast(`üç∫ Promille auf ${val.toFixed(1)}‚Ä∞ gesetzt!`, 'success');
  };

  window.saveLocation = async function() {
    if (!isConfigured) { showToast('Firebase nicht konfiguriert!', 'error'); return; }
    const loc = document.getElementById('locationInput').value.trim();
    if (!loc) { showToast('Bitte Standort eingeben!', 'error'); return; }
    await updateDoc(doc(db, 'polter', 'state'), { location: loc, locationTime: serverTimestamp() });
    document.getElementById('currentLocDisplay').innerHTML = `Aktuell: <strong>${loc}</strong>`;
    document.getElementById('locationInput').value = '';
    showToast('üìç Standort aktualisiert!', 'success');
  };

  window.getGeoLocation = function() {
    if (!navigator.geolocation) { showToast('GPS nicht verf√ºgbar', 'error'); return; }
    showToast('GPS wird ermittelt...', '');
    navigator.geolocation.getCurrentPosition(async pos => {
      const { latitude, longitude } = pos.coords;
      // Reverse geocode via nominatim
      try {
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
        const data = await res.json();
        const addr = data.display_name || `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
        document.getElementById('locationInput').value = addr;
        showToast('üì° GPS-Position gefunden!', 'success');
      } catch {
        document.getElementById('locationInput').value = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
        showToast('üì° Koordinaten eingef√ºgt!', 'success');
      }
    }, () => showToast('GPS-Zugriff verweigert', 'error'));
  };

  function showToast(msg, type) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.className = `toast${type ? ' ' + type : ''} show`;
    setTimeout(() => el.classList.remove('show'), 2500);
  }
</script>
</body>
</html>
